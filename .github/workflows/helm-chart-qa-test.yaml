name: Helm package and push for QA-test

on:
  workflow_dispatch:
    inputs:
      aspnet:
        type: boolean
        description: Check to build the helm chart for aspnet
        required: false
        default: "false"
      wordpress:
        type: boolean
        description: Check to build the helm chart for wordpress
        required: false
        default: "false"

env:
  ENVIRONMENT: "qa"

jobs:
  helm-chart-aspnet-qa:
    runs-on: ubuntu-latest
    env:
      SERVICE_NAME: "aspnet"
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install Helm
        run: |-
          curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
          chmod 700 get_helm.sh
          ./get_helm.sh
      - name: Helm package
        run: |-
          ls -al
          echo ${{ env.SERVICE_NAME }}
          pushd charts/${{ env.SERVICE_NAME }} 
          sed -i s/${{ env.SERVICE_NAME }}  /${{ env.SERVICE_NAME }} -${{ env.ENVIRONMENT }}/g Chart.yaml
          mv values-${{ env.ENVIRONMENT }}.yaml values.yaml
          ls -al
          popd 
          helm package ${{ env.SERVICE_NAME }}